<?= $this->extend('landing/template/default') ?>

<?= $this->section('custom-css') ?>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<?= $this->endSection('custom-css') ?>

<?= $this->section('content') ?>
<section class="mx-auto px-28 pt-16 pb-20 mt-20 bg-[#4C1FAD] relative">
    <div class="flex w-full relative lg:w-[85%]">
        <div>
            <p class="text-7xl font-bold text-white flex">ExploIT</p>
            <p class="text-[#3FD78F] text-xl mt-8 flex">Choose your best team!</p>
        </div>
    </div>
    <img class="hidden sm:block absolute right-0 top-5" src="<?= base_url(); ?>/home/vote.png" alt="">
</section>

<section>
    <?php if (session()->getFlashdata('msg')) : ?>
        <div class="bg-green-400 w-full lg:w-[90%] border-[1px] rounded-xl p-2 my-2 text-3xl text-white text-center mx-auto">
            <?= session()->getFlashdata('msg'); ?>
        </div>
    <?php elseif (session()->getFlashdata('error')) : ?>
        <div class="bg-red-400 w-full lg:w-[90%] border-[1px] rounded-xl p-2 my-2 text-3xl text-center mx-auto text-white">
            <?= session()->getFlashdata('error'); ?>
        </div>
    <?php endif; ?>
    <div class="flex flex-wrap gap-2 my-24 md:relative md:overflow-auto mx-auto w-full lg:w-[90%]">
        <?php foreach ($tenants as $t) : ?>
            <div class="border-black bg-white border-2 w-full rounded-2xl p-6 flex flex-col justify-between max-w-xs mb-4 mt-4 mx-auto">
                <!-- id -->
                <div class="">
                    <img id="img_<?= $t['exploit_tim_id']; ?>" src="<?= base_url(); ?>/home/ctf.png" class="w-full">
                    <div id="product_<?= $t['exploit_tim_id']; ?>" class="mt-4 py-4 font-bold text-3xl">
                        <?= $t['exploit_nama_produk']; ?>
                    </div>
                    <div class="border-2 border-[#339969] p-2 rounded-2xl w-fit bg-[#EFFFF7]">
                        <p id="team_<?= $t['exploit_tim_id']; ?>" class="text-[#339969]">
                            <?= $t['exploit_tim_nama']; ?>
                        </p>
                    </div>
                </div>
                <div class="w-full mt-[60px] flex">
                    <button class="font-bold text-xl block mx-auto text-center border-2 w-full border-black bg-[#F3CA20] p-2 rounded-2xl" onclick="toggleModal('<?= $t['exploit_tim_id']; ?>', `<?= $t['exploit_desk_produk']; ?>`)">Vote</button>
                </div>
            </div>
        <?php endforeach; ?>
    </div>

</section>
<!-- Modal -->
<div id="modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center">
    <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50"></div>

    <div class="modal-container bg-white w-11/12 md:w-8/12 lg:w-1/2 mx-auto rounded-xl shadow-lg z-50 h-[50%] overflow-y-auto">
        <!-- Add margin if you want to see some of the overlay behind the modal-->
        <div class="py-4 text-left px-6 flex gap-2 flex-col md:flex-row">
            <!--Title-->
            <div class="flex w-full md:w-1/2 p-4 rounded-2xl mx-auto">
                <img id="modal_img" class="h-fit mx-auto" alt="">
            </div>
            <div class="flex w-full md:w-1/2">
                <form method="post" name="vote" action="<?= base_url() ?>/exploit/vote/tenants">
                    <!--Body-->
                    <input type="hidden" id="id_tenant" name="id_tenant" value="">
                    <div class="grid grid-col content-between ">
                        <div id="modal_team_product" class="mt-2 pb-4 font-bold text-3xl">
                            -
                        </div>
                        <div class="border-2 border-[#339969] p-2 rounded-2xl w-fit bg-[#EFFFF7]">
                            <p id="modal_team_name" class="text-[#339969]">
                                -
                            </p>
                        </div>
                        <div class="mt-4">
                            <p id="content_main">-</p>
                        </div>

                        <!--Footer-->
                        <div class="flex flex-col pt-2 gap-2">
                            <div>
                                <label for="token" class="block">
                                    <span class="block text-sm text-slate-700"><span class="font-bold">token</span>
                                        <input type="text" id="token" name="token" value="<?= old('token') ?>" required class="mt-1 px-3 py-2 bg-white border-2 shadow-sm border-black placeholder-slate-400 focus:outline-none focus:border-sky-500 focus:ring-sky-500 block w-full rounded-md sm:text-sm focus:ring-1" />
                                </label>
                            </div>
                            <div class="flex gap-2">
                                <button class="modal-close px-4 p-2 bg-slate-200 rounded-lg hover:text-white border border-black font-bold">Cancel</button>
                                <button type="submit" class="px-4 p-2 font-bold bg-[#F3CA20] rounded-lg hover:text-white border border-black">Vote</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
<?= $this->endSection() ?>
<?= $this->section('custom-js') ?>
<script src="<?= base_url(); ?>/src/js/navbar/menu-initiator.js"></script>
<script src="src/js/navbar/countdown.js"></script>
<script>
    var openmodal = document.querySelectorAll('.modal-open')
    for (var i = 0; i < openmodal.length; i++) {
        openmodal[i].addEventListener('click', function(event) {
            event.preventDefault()
            toggleModal()
        })
    }

    const overlay = document.querySelector('.modal-overlay')
    // overlay.addEventListener('click', toggleModal)

    var closemodal = document.querySelectorAll('.modal-close')
    for (var i = 0; i < closemodal.length; i++) {
        closemodal[i].addEventListener('click', toggleModal)
    }

    document.onkeydown = function(evt) {
        evt = evt || window.event
        var isEscape = false
        if ("key" in evt) {
            isEscape = (evt.key === "Escape" || evt.key === "Esc")
        } else {
            isEscape = (evt.keyCode === 27)
        }
        if (isEscape && document.body.classList.contains('modal-active')) {
            toggleModal()
        }
    };

    function toggleModal(id, content) {
        const body = document.querySelector('body')
        const modal = document.querySelector('.modal')
        modal.classList.toggle('opacity-0')
        modal.classList.toggle('pointer-events-none')
        body.classList.toggle('modal-active')
        if (id && content) {
            document.querySelector('#id_tenant').value = id;
            document.querySelector('#modal_team_name').innerHTML = document.querySelector('#team_' + id).innerHTML;
            document.querySelector('#modal_team_product').innerHTML = document.querySelector('#product_' + id).innerHTML;
            document.querySelector('#content_main').innerHTML = content;
            const img_src = document.querySelector('#img_' + id).src;
            document.querySelector('#modal_img').src = img_src
        }
    }
    const modalOver = document.querySelector('.modal-overlay')
    window.onclick = function(event) {
        if (event.target == modalOver) {
            toggleModal();
        }
    }
</script>
<?= $this->endSection('custom-js') ?>